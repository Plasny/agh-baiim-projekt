<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>BAIM Projekt - TASK 2</title>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            loadPage = document.getElementById("loadPage");
            frame = document.getElementById("resultFrame");
            checkAnswer = document.getElementById("checkAnswer");
            loadPage.addEventListener("click", function () {
                const siteContent = document.getElementById("siteContent").value;
                const blob = new Blob([siteContent], {type: 'text/html'});
                const url = URL.createObjectURL(blob);
                frame.src = url;
            });
            checkAnswer.addEventListener("click", function () {
                fetch('/session')
                .then(response => response.json())
                .then(data => {
                    if (data.task2_completed) {
                        alert('Zadanie wykonane poprawnie!');
                            window.location.href = '/';
                    } else {
                        alert('Zadanie nie zostało jeszcze wykonane poprawnie. Spróbuj ponownie.');
                    }
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
            });
        });
    </script>
</head>

<body>
    <h2>Zadanie 2. (Formularz)</h2>
    <p>Tym razem strona jest trochę minimalnie bardziej zabezpieczona. Wykorzystujemy zapytanie POST, dodatkowo serwer blokuje zapytania wykonywane za pomocą fetch-a. Jednak dalej możliwe jest zmienienie statusu. Jak to zrobisz?</p>

    <p>Przygotuj stronę, która po załadowaniu (bez udziału użytkownika) automatycznie zmieni status na stronie ustawień aplikacji (http://localhost:8081/task2) na "wykonano".</p>

    <p>Najpierw zobacz jak działa ta strona: <a href="http://localhost:8081/task2">/task2</a></p>

    <details>
      <summary>Zadanie dodatkowe</summary>
      <p>Spróbuj to zrobić w taki sposób żeby użytkownik nie zobaczył że status został zmieniony. Żeby strona nie została przekierowana.</p>
    </details>

    <hr>

    <details>
        <summary>Podpowiedź 1 (od czego zacząć)</summary>
        Zobacz jak wygląda ruch sieciowy w zakładce Network narzędzi developerskich przeglądarki podczas zmiany hasła. Co się zmieniło względem 1 zadania?
    </details>
    <details>
        <summary>Podpowiedź 2 (co warto przeczytać)</summary>
        <ul style="margin-top: 0;">
            <li>
                <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Guides/CORS" target="_blank">
                    CORS Guide (MDN)
                </a>
            </li>
            <li>
                <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Elements/form" target="_blank">
                    HTML form element (MDN)
                </a>
            </li>
        </ul>
        <div style="margin-top: 5px; font-size: 0.9em; color: #444; background: #f9f9f9; padding: 5px; border-left: 3px solid #ccc;">
            <p>
                Stwórz formularz <code>&lt;form&gt;</code> z odpowiednią metodą i ukrytymi polami <code>type="hidden"</code>. Użyj JavaScriptu w znaczniku <code>&lt;body&gt;</code>. Komenda <code>onload="document.forms[0].submit()"</code> sprawi, że formularz wyśle się sam po wejściu na stronę.
            </p>
        </div>
    </details>
    <details>
        <summary>Podpowiedź do zadania dodatkowego</summary>
        <ul style="margin-top: 0;">
            <li>
                <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Elements/form#target" target="_blank">
                    HTML form element - target field (MDN)
                </a>
            </li>
            <li>
                <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Elements/iframe" target="_blank">
                    HTML iframe element (MDN)
                </a>
            </li>
        </ul>
    </details>

    <hr>

    <div style="display: flex; gap: 10px;">

        <div style="width: 100%;">
            <label for="siteContent"><strong>HTML Source</strong></label><br />
            <textarea id="siteContent" style="width: calc(100% - 10px); height: calc(50vh - 10px); border: 1px solid black; padding: 5px;">
<!DOCTYPE html>
<html lang="en">

<head>
    <title>Local Content</title>
    <script>
        function log() {
            console.log('hello')
        }
    </script>
</head>

<body onload="log()">
    <p>Occaecat id anim cillum nulla enim incididunt laboris veniam enim elit anim. Anim do pariatur exercitation cupidatat velit. Commodo reprehenderit in est. Officia sint do ut. Cillum dolor elit reprehenderit voluptate occaecat ad proident fugiat quis fugiat duis id consequat commodo excepteur. Qui do dolor aute aute ut nisi culpa nulla exercitation consectetur pariatur eu id aliqua. Esse fugiat ipsum adipisicing esse ad voluptate proident sunt. Aute proident ut enim aliquip cillum magna aute et.</p>
</body>

</html>
            </textarea>
        </div>

        <div style="width: 100%;">
            <label for="resultFrame"><strong>Preview</strong></label><br />
            <iframe id="resultFrame" style="width: 100%; height: 50vh; border: 1px solid black;"></iframe>
        </div>

    </div>

    <button id="loadPage">Załaduj stronę</button>
    <button id="checkAnswer">Sprawdź odpowiedź</button>
    <button onclick="window.history.back()">Cofnij</button>
</body>

</html>
