<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>BAIM Projekt - TASK 3</title>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            loadPage = document.getElementById("loadPage");
            frame = document.getElementById("resultFrame");
            checkAnswer = document.getElementById("checkAnswer");
            loadPage.addEventListener("click", function () {
                const siteContent = document.getElementById("siteContent").value;
                const blob = new Blob([siteContent], {type: 'text/html'});
                const url = URL.createObjectURL(blob);
                frame.src = url;
            });
            checkAnswer.addEventListener("click", function () {
                fetch('/session')
                    .then(response => response.json())
                    .then(data => {
                        if (data.task3_completed) {
                            alert('Zadanie wykonane poprawnie!');
                            window.location.href = '/';
                        } else {
                            alert('Zadanie nie zostało jeszcze wykonane poprawnie. Spróbuj ponownie.');
                        }
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
            });
        });
    </script>
</head>

<body>
    <h2>Zadanie 3. (JSON)</h2>
    <p>Ta strona wykorzystuje JSON API, a programista tego serwera uznał, że skoro formularze HTML nie potrafią wysyłać JSON-a, to nie potrzebuje tokenów CSRF.</p>

    <p>Przygotuj stronę, która po załadowaniu (bez udziału użytkownika) automatycznie zmieni role użytkownika
        (http://localhost:8081/task3) na "admin".</p>

    <p>Najpierw zobacz jak działa ta strona: <a href="http://localhost:8081/task3">/task3</a></p>

    <details>
        <summary>Zadanie dodatkowe</summary>
        <p>Zastanów się jakie sprawdzenie po stronie serwera wystarczyłoby dodać, żeby zapobiec temu atakowi. Inne niż jednorazowy token.</p>
    </details>

    <hr>

    <details>
        <summary>Podpowiedź 1 (Typ kodowania)</summary>
        Formularz HTML posiada atrybut <code>enctype</code>. Domyślnie jest to <code>application/x-www-form-urlencoded</code>.
        Ale istnieją też inne. <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Elements/form#enctype" target="_blank">HTML form element - enctype field (MDN)</a>
    </details>
    <details>
        <summary>Podpowiedź 2 (o JSONie)</summary>
        <ul style="margin-top: 0;">
            <li>
                <a href="https://www.rfc-editor.org/rfc/rfc8259">The JSON Data Interchange Format (RFC 8259)</a>
            </li>
            <li>
                <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON" target="_blank">JSON (MDN)</a>
            </li>
        </ul>
    </details>

    <hr>

    <div style="display: flex; gap: 10px;">

        <div style="width: 100%;">
            <label for="siteContent"><strong>HTML Source</strong></label><br />
            <textarea id="siteContent" style="width: calc(100% - 10px); height: calc(50vh - 10px); border: 1px solid black; padding: 5px;">
<!DOCTYPE html>
<html lang="en">

<head>
    <title>Local Content</title>
    <script>
        function log() {
            console.log('hello')
        }
    </script>
</head>

<body onload="log()">
    <p>Occaecat id anim cillum nulla enim incididunt laboris veniam enim elit anim. Anim do pariatur exercitation cupidatat velit. Commodo reprehenderit in est. Officia sint do ut. Cillum dolor elit reprehenderit voluptate occaecat ad proident fugiat quis fugiat duis id consequat commodo excepteur. Qui do dolor aute aute ut nisi culpa nulla exercitation consectetur pariatur eu id aliqua. Esse fugiat ipsum adipisicing esse ad voluptate proident sunt. Aute proident ut enim aliquip cillum magna aute et.</p>
</body>

</html>
            </textarea>
        </div>

        <div style="width: 100%;">
            <label for="resultFrame"><strong>Preview</strong></label><br />
            <iframe id="resultFrame" style="width: 100%; height: 50vh; border: 1px solid black;"></iframe>
        </div>

    </div>

    <button id="loadPage">Załaduj stronę</button>
    <button id="checkAnswer">Sprawdź odpowiedź</button>
    <button onclick="window.history.back()">Cofnij</button>
</body>

</html>
